.\" Created from Texinfo source by yat2m 1.51
.TH GPG-MAIL-TUBE 1 2024-11-22 "GnuPG 2.5.2" "GNU Privacy Guard 2.6"
.SH NAME
.B gpg-mail-tube
\- Encrypt rfc822 formatted mail in a pipeline
.SH SYNOPSIS
.B gpg\-mail\-tube
.RI [ options ]
.I recipients

.SH DESCRIPTION
\fBgpg\-mail\-tube\fP takes RFC-822 formatted mail on stdin and
turns it into a PGP/MIME encrypted mail which is then written to
stdout.

The recipients must be plain mail addresses
(e.g. \fBfoo@example.org\fP) and should in general list the To and
Cc addresses contained in the mail.

.SH OPTIONS

\fBgpg\-mail\-tube\fP understands these options:


.TP
.B  \-\-verbose
.TQ
.B  \-v
Enable extra informational output.

.TP
.B  \-\-quiet
.TQ
.B  \-q
Try to be as quiet as possible.

.TP
.B  \-\-log\-file \fIfile\fP
Write log output to \fIfile\fP.  Use \(oq\fIsocket://\fP\(cq to log to a
socket.

.TP
.B  \-\-no\-stderr
Suppresses all output to stderr.  This is useful for callers which
don't distinguish stdout and stderr.  To get diagnostics the option
\fB\-\-log\-file\fP can be used.

.TP
.B  \-\-header \fIname\fP=\fIvalue\fP
Add the mail header "\fIname\fP: \fIvalue\fP" to the output.

.TP
.B  \-\-setenv \fIname\fP=\fIvalue\fP
Put the given environment string into the environment of this process
and of the called gpg.  This option is required if there is no other
way to set the environemt.

.TP
.B  \-\-as\-attach
.TQ
.B  \-a
Do not write a PGP/MIME mail but emit a simple body along with an
attachment containing the encrypted body of the input mail.  If the
input was a plain text message a simple encrypted file will be
attached.  If the input was a multipart MIME message the encrypted
file is of type message/rfc822.

.TP
.B  \-\-gpg \fIgpgcmd\fP
Use the specified command \fIgpgcmd\fP instead of \fBgpg\fP.

.TP
.B  \-\-vsd
Use the gpg from a \fIGnuPG VS-DesktopÂ®\fP AppImage.  The AppImage is
started if it is not running.  A symlink named
\(oq\fI~/.gnupg\-vsd/gnupg\-vs\-desktop.AppImage\fP\(cq needs to link to the
actually to be used AppImage.

.TP
.B  \-\-version
Print version of the program and exit.

.TP
.B  \-\-help
Display a brief help page and exit.

.P

.SH EXAMPLES


The following options can be used in a local transport rule of the
Exim MTA which assumes that that \fBcheck_local_user\fP has been
used in the router.

.RS 2
.nf
transport_filter = /usr/local/bin/gpg\-mail\-tube \-\-setenv HOME=${home} \[rs]
                   \-\-no\-stderr \-\- $pipe_addresses
.fi
.RE


For a remote transport the use of \fBsize_addition\fP and an
explicit setting of the user and its home directory might be required.
To avoid permission problems it is often better to use a service like
\fBuserv\fP to run the command under a different user.  This can
be done by using this transport_filter:

.RS 2
.nf
transport_filter = /usr/bin/userv \-\- foo gpg\-mail\-tube $pipe_addresses
.fi
.RE

With \fIfoo\fP being the account name used by GnuPG.  In that user's
home directory you will install a file \(oq\fI~/.userv/rc\fP\(cq with this
content:

.RS 2
.nf
if ( glob service gpg\-mail\-tube
     & glob calling\-user Debian\-exim
     & glob service\-user foo
   )
   reset
   errors\-to\-syslog
   no\-suppress\-args
   execute /usr/local/bin/gpg\-mail\-tube \[rs]
      \-v \-\-no\-stderr \[rs]
      \-\-log\-file /home/foo/logs/mail\-tube.log \[rs]
      \-\-setenv HOME=/home/foo  \-\-
   quit
fi
.fi
.RE

Take care to have the trailing double dashes and adjust the log-file
as needed.  The errors-to-syslog statement makes sure that errors
pertaining to the userv system (e.g. script errors) are directed to
the syslog (facility is "user", level is "error").  If needed replace
Debian-exim by the name of the user under which Exim is running.


.SH DIAGNOSTICS

The program returns 0 on a successful encryption or a non-zero value
on error.  Note that on error some output might have already been
written to stdout.

.SH SEE ALSO
\fBgpg\fP(1),

The full documentation for this tool is maintained as a Texinfo manual.
If GnuPG and the info program are properly installed at your site, the
command

.RS 2
.nf
info gnupg
.fi
.RE

should give you access to the complete manual including a menu structure
and an index.




